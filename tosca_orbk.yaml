tosca_definitions_version: tosca_simple_yaml_1_2

description: Experiments with deployment of wordpress and mysql


data_types:
  generate:
    properties:
      secret:
        name:
          type: string
        namespace:
          type: string
        literals:
          type: list
        resources:
          type: list
      order:
         type: integer
  discover:
    propeties:
      target:
        type: string
      order:
        type: string
  deploy:
    properties:
      application:
        type: string
      images:
        type: list
      order:
        type: string


node_types:

  tosca.nodes.Compute.EdgeNode:
    derived_from: tosca.nodes.Compute
    properties:
      gpu_model:
        model:
          type: string
          required: false
        dedicated:
          type: boolean
          default: true
        type: map
        required: false

  tosca.nodes.Compute.PublicCloud:
    derived_from: tosca.nodes.Compute
    properties:
      gpu_model:
        model:
          type: string
          required: false
        dedicated:
          type: boolean
          default: true
        type: map
        required: false



  ACCORDION.Cloud_Framework:
    derived_from: tosca.nodes.Container.Application.Docker
    properties:
      actions:
        type: map


  Component:
    derived_from: tosca.nodes.Container.Application.Docker
    properties:
      name:
        type: string
      application:
        type: string
      external_ip:
        type: boolean
      deployment_unit:
        type: string
      ip:
        type: string
      port:
        type: string
      env:
        type: list
        required: false
    requirements:
      - host:
          node: tosca.nodes.Compute
          relationship: hostedOn





relationship_types:
  hostedOn:
    derived_from: tosca.relationships.Root
    valid_target_types: [ tosca.capabilities.Node ]

topology_template:
  inputs:
    ip:
      type: string
      description: IP of containers
      required: false

  node_templates:
    Cloud_Framework:
      type: ACCORDION.Cloud_Framework
      properties:
        actions:
          deploy:
            properties:
              application: orbk
              images:
                - GameServer:
                    name: orbkaccserver:v1.0
                    internal: true
              order: 1
          terminate:
            properties:
              application: orbk
              images:
                - GameServer:
                    name: orbkccserver:v1.0
                    internal: true
              order: 2


    EdgeNode:
      type: tosca.nodes.Compute.EdgeNode
      capabilities:
        host:
          properties:
            num_cpus: 1
            mem_size: 512 MB
            disk_size: 20 GB
        os:
          properties:
            architecture: x86_64
            type: linux



    GameServer.component:
      type: Component
      properties:
        name: gameserver
        application: orbk
        external_ip: true
        deployment_unit: container
        ip: {get_input: ip}
        port: 20765
      requirements:
        - host:
            node: EdgeNode
            relationship: hostedOn















