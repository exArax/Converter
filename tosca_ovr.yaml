tosca_definitions_version: tosca_simple_yaml_1_2

description: Experiments with deployment of wordpress and mysql


data_types:
  input:
    parameters:
      type: string
  generate:
    properties:
      secret:
        name:
          type: string
        namespace:
          type: string
        literals:
          type: list
        resources:
          type: list
      order:
         type: string
  discover:
    propeties:
      target:
        type: string
      order:
        type: string
  deploy:
    properties:
      application:
        type: string
      images:
        type: list
      order:
        type: string

  requestSession:
    properties:
      application:
        type: string
      images:
        type: list
      order:
        type: string


node_types:

  tosca.nodes.Compute.EdgeNode:
    derived_from: tosca.nodes.Compute
    properties:
      gpu_model:
        model:
          type: string
          required: false
        dedicated:
          type: boolean
          default: true
        type: map
        required: false

  tosca.nodes.Compute.PublicCloud:
    derived_from: tosca.nodes.Compute


  ACCORDION.Cloud_Framework:
    derived_from: tosca.nodes.Container.Application.Docker
    properties:
      actions:
        type: map


  Component:
    derived_from: tosca.nodes.Container.Application.Docker
    properties:
      name:
        type: string
      application:
        type: string
      external_ip:
        type: string
        required: false
      ip:
        type: string
      deployment_unit:
        type: string
      flavor:
        type: string
      port:
        type: string
        required: false
      env:
        type: list
        required: false
      dependecy:
        type: list
        required: false
      input:
        type: map
        required: false
    requirements:
      - host:
          node: tosca.nodes.Compute
          relationship: hostedOn





relationship_types:
  hostedOn:
    derived_from: tosca.relationships.Root
    valid_target_types: [ tosca.capabilities.Node ]

topology_template:
  inputs:
    ip:
      type: string
      description: IP of containers
      required: false

  node_templates:
    Cloud_Framework:
      type: ACCORDION.Cloud_Framework
      properties:
        actions:
          deploy:
            properties:
              application: ovr
              images:
                - SingalingServer:
                    name: signaling-server
                    internal: true
                - LocalService:
                    name: local-service
                    internal: true
              order: 1
          requestSession:
            properties:
              application: ovr
              images:
                - RelayServer:
                    name: remote-service
                    internal: true
              order: 2


    EdgeNode1:
      type: tosca.nodes.Compute.EdgeNode
      properties:
        gpu_model:
          model: NVIDIA GeForce RTX 20-series
          dedicated: true
      capabilities:
        host:
          properties:
            num_cpus: 1
            mem_size: 512 MB
            disk_size: 20 GB
        os:
          properties:
            architecture: x86_64
            type: linux

    EdgeNode2:
      type: tosca.nodes.Compute.EdgeNode
      capabilities:
        host:
          properties:
            num_cpus: 1
            mem_size: 256 MB
            disk_size: 918 MB
        os:
          properties:
            architecture: x86_64
            type: linux

    PublicCloud:
      type: tosca.nodes.Compute.PublicCloud
      capabilities:
        host:
          properties:
            num_cpus: 2
            mem_size: 2 GB
            disk_size: 35 GB
        os:
          properties:
            architecture: x86_64
            type: linux


    SignalingServer.component:
      type: Component
      properties:
        name: singalingserver
        application: ovr
        external_ip: false
        ip: { get_input: ip }
        port: 9090
        deployment_unit: container
      requirements:
        - host:
            node: EdgeNode2
            relationship: hostedOn

    RelayServer.component:
      type: Component
      properties:
        name: relayserver
        application: ovr
        external_ip: true
        ip: { get_input: ip }
        deployment_unit: vm
        flavor: win2k12-iso
        port: 5055, 5056
        input:
          parameters: RelayServer.component.properties.external_ip
      requirements:
        - host:
            node: PublicCloud
            relationship: hostedOn

    LocalService.component:
      type: Component
      properties:
        name:  localservice
        application: ovr
        external_ip: false
        ip: {get_input: ip}
        deployment_unit: vm
        flavor: win2k12-iso
        dependency: [SignalingServer.component]
        input:
          parameters: SignalingServer.component.properties.ip
      requirements:
        - host:
            node: EdgeNode1
            relationship: hostedOn














